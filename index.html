<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üí¨ ChatMasala</title>
  <style>
    :root {
      --bg: #f3f6f8;
      --panel: #ffffff;
      --accent: #ff7043;
      --accent2: #ff8a65;
      --muted: #64748b;
      --incoming: #fffaf0;
      --outgoing: #e0f7fa;
    }

    [data-theme="dark"] {
      --bg: #0f172a;
      --panel: #1e293b;
      --accent: #ff8a65;
      --accent2: #ff7043;
      --muted: #94a3b8;
      --incoming: #2d3748;
      --outgoing: #334155;
    }

    body {
      margin: 0;
      font-family: "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--muted);
      height: 100vh;
      display: flex;
      align-items: stretch;
    }

    .app {
      margin: auto;
      width: 95%;
      height: 92vh;
      max-width: 1200px;
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 18px;
    }

    .sidebar {
      background: var(--panel);
      border-radius: 14px;
      padding: 18px;
      box-shadow: 0 6px 20px rgba(8,32,50,0.06);
      display: flex;
      flex-direction: column;
    }

    .profile {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 15px;
    }

    .profile img {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      border: 2px solid var(--accent);
    }

    .profile .name {
      font-weight: 700;
      color: var(--accent);
    }

    .rooms {
      flex: 1;
      overflow-y: auto;
    }

    .room {
      padding: 10px;
      border-radius: 10px;
      cursor: pointer;
    }

    .room:hover {
      background: #ffe0b2;
    }

    .room.active {
      background: linear-gradient(90deg, var(--accent2), var(--accent));
      color: white;
    }

    .panel {
      background: var(--panel);
      border-radius: 14px;
      display: flex;
      flex-direction: column;
    }

    .header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 15px;
      border-bottom: 1px solid #ddd;
    }

    .header img {
      width: 40px;
      height: 40px;
      border-radius: 10px;
    }

    .messages {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .msg {
      display: flex;
      gap: 8px;
      max-width: 75%;
    }

    .msg.out {
      margin-left: auto;
      flex-direction: row-reverse;
    }

    .bubble {
      background: var(--incoming);
      padding: 10px 12px;
      border-radius: 12px;
    }

    .bubble.out {
      background: var(--outgoing);
    }

    .metaSmall {
      font-size: 11px;
      color: var(--muted);
      margin-top: 4px;
    }

    .composer {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px;
      border-top: 1px solid #ddd;
    }

    .composer input[type="text"] {
      flex: 1;
      padding: 10px;
      border-radius: 20px;
      border: 1px solid #ccc;
      background: var(--bg);
      color: black;
    }

    .btn {
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 50%;
      width: 42px;
      height: 42px;
      cursor: pointer;
    }

    .attach {
      background: transparent;
      border: 1px dashed #ccc;
      padding: 8px;
      border-radius: 8px;
      cursor: pointer;
    }

    .toggle {
      background: var(--accent2);
      color: white;
      border: none;
      border-radius: 6px;
      padding: 5px 8px;
      cursor: pointer;
      font-size: 12px;
    }

    @media (max-width: 850px) {
      .app {
        grid-template-columns: 1fr;
      }
      .sidebar {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="sidebar">
      <div class="profile">
        <img id="profileImg" src="https://api.dicebear.com/7.x/fun-emoji/svg?seed=panda" alt="avatar" />
        <div>
          <div class="name" id="userNameLabel">Guest</div>
          <button id="themeToggle" class="toggle">üåô</button>
        </div>
      </div>

      <input id="newRoomInput" placeholder="New room name" />
      <button id="createRoomBtn" class="btn">+</button>

      <div class="rooms" id="roomsList"></div>
    </div>

    <div class="panel">
      <div class="header">
        <img id="roomAvatar" src="https://api.dicebear.com/7.x/fun-emoji/svg?seed=cat" />
        <div>
          <div class="room-title" id="roomTitle">Select / Create Room</div>
          <div class="metaSmall" id="roomMeta">Realtime ChatMasala üí¨</div>
        </div>
      </div>

      <div class="messages" id="messages"></div>

      <div class="composer">
        <button id="attachBtn" class="attach">üìé</button>
        <input type="file" id="fileInput" style="display:none" />
        <input type="text" id="messageInput" placeholder="Type your masala..." />
        <button id="sendBtn" class="btn">‚û°Ô∏è</button>
      </div>
    </div>
  </div>

  <!-- Firebase compat SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    // ‚úÖ Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBg_DmvYAdZe5CmyonHuOn-p12yKrwDN_E",
      authDomain: "chatmasala-e8c77.firebaseapp.com",
      databaseURL: "https://chatmasala-e8c77-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "chatmasala-e8c77",
      storageBucket: "chatmasala-e8c77.firebasestorage.app",
      messagingSenderId: "106320406325",
      appId: "1:106320406325:web:686307a37df2f01ce48e7c",
      measurementId: "G-EPZN4PS4RH"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Elements
    const userNameLabel = document.getElementById("userNameLabel");
    const roomsList = document.getElementById("roomsList");
    const roomTitle = document.getElementById("roomTitle");
    const messagesEl = document.getElementById("messages");
    const messageInput = document.getElementById("messageInput");
    const sendBtn = document.getElementById("sendBtn");
    const fileInput = document.getElementById("fileInput");
    const attachBtn = document.getElementById("attachBtn");
    const createRoomBtn = document.getElementById("createRoomBtn");
    const newRoomInput = document.getElementById("newRoomInput");
    const themeToggle = document.getElementById("themeToggle");

    let currentUser = localStorage.getItem("chatUser") || prompt("Enter your name:");
    localStorage.setItem("chatUser", currentUser);
    userNameLabel.textContent = currentUser;

    let currentRoomId = null;
    let pendingFile = null;

    // Toggle theme
    themeToggle.addEventListener("click", () => {
      const theme = document.body.dataset.theme === "dark" ? "" : "dark";
      document.body.dataset.theme = theme;
      themeToggle.textContent = theme === "dark" ? "‚òÄÔ∏è" : "üåô";
    });

    // Create Room
    createRoomBtn.addEventListener("click", () => {
      const name = newRoomInput.value.trim();
      if (!name) return alert("Enter room name");
      firebase.database().ref("rooms").push({ name, createdAt: Date.now() });
      newRoomInput.value = "";
    });

    // Show rooms
    firebase.database().ref("rooms").on("child_added", (snap) => {
      const room = snap.val();
      const div = document.createElement("div");
      div.className = "room";
      div.textContent = room.name;
      div.onclick = () => selectRoom(snap.key, room.name);
      roomsList.appendChild(div);
    });

    function selectRoom(id, name) {
      currentRoomId = id;
      roomTitle.textContent = name;
      messagesEl.innerHTML = "";
      firebase.database().ref("messages/" + id).off();
      firebase.database().ref("messages/" + id).on("child_added", (snap) => {
        appendMessage(snap.key, snap.val());
      });
    }

    // Send message
    sendBtn.addEventListener("click", sendMessage);
    messageInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") sendMessage();
    });

    function sendMessage() {
      const text = messageInput.value.trim();
      if (!text && !pendingFile) return;
      const ref = firebase.database().ref("messages/" + currentRoomId);
      const msg = {
        user: currentUser,
        text: text || null,
        time: Date.now(),
        file: pendingFile ? pendingFile.name : null,
      };
      ref.push(msg);
      messageInput.value = "";
      pendingFile = null;
    }

    // Attach file
    attachBtn.onclick = () => fileInput.click();
    fileInput.onchange = (e) => {
      const f = e.target.files[0];
      if (!f) return;
      pendingFile = f;
      alert("File ready: " + f.name);
    };

    function appendMessage(id, data) {
      const div = document.createElement("div");
      div.className = "msg" + (data.user === currentUser ? " out" : "");
      div.innerHTML = `
        <div class="bubble ${data.user === currentUser ? "out" : ""}">
          <strong>${data.user}</strong><br>
          ${data.text ? data.text : ""}
          ${data.file ? `<div class='metaSmall'>üìé ${data.file}</div>` : ""}
          <div class="metaSmall">${new Date(data.time).toLocaleTimeString()}</div>
        </div>`;
      messagesEl.appendChild(div);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }
  </script>
</body>
</html>
